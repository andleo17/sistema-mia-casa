# Migration `20200614205310-arreglando-un-poco-la-base-de-datos`

This migration has been generated by Andres Baldarrago at 6/14/2020, 8:53:11 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."InsumoProducto" (
"cantidad" Decimal(65,30)  NOT NULL ,"insumoId" integer  NOT NULL ,"productoId" integer  NOT NULL ,"unidad" text  NOT NULL ,
    PRIMARY KEY ("productoId","insumoId"))

ALTER TABLE "public"."Cargo" ADD COLUMN "estado" boolean  NOT NULL DEFAULT true;

ALTER TABLE "public"."Compra" ALTER COLUMN "fecha" DROP DEFAULT;

ALTER TABLE "public"."Credencial" ADD COLUMN "estado" boolean  NOT NULL DEFAULT true;

ALTER TABLE "public"."DetalleCompra" ADD COLUMN "unidad" text  NOT NULL ;

ALTER TABLE "public"."DetallePedido" ADD COLUMN "entregado" boolean  NOT NULL DEFAULT false,
ADD COLUMN "estado" boolean  NOT NULL DEFAULT true;

ALTER TABLE "public"."Insumo" ADD COLUMN "cantidad" Decimal(65,30)  NOT NULL ,
ADD COLUMN "estado" boolean  NOT NULL DEFAULT true,
ADD COLUMN "unidad" text  NOT NULL ;

ALTER TABLE "public"."Mesa" ADD COLUMN "estado" boolean  NOT NULL DEFAULT true,
ALTER COLUMN "ocupado" SET DEFAULT false;

ALTER TABLE "public"."Personal" ADD COLUMN "estado" boolean  NOT NULL DEFAULT true,
ADD COLUMN "sueldo" Decimal(65,30)  NOT NULL ;

ALTER TABLE "public"."Producto" ADD COLUMN "cantidad" integer  NOT NULL ,
ADD COLUMN "descripcion" text  NOT NULL ,
ALTER COLUMN "estado" SET DEFAULT true;

ALTER TABLE "public"."Reclamo" DROP CONSTRAINT IF EXiSTS "Reclamo_pedidoId_fkey",
ADD COLUMN "productoId" integer  NOT NULL ;

CREATE UNIQUE INDEX "Compra.serie_numero" ON "public"."Compra"("serie","numero")

CREATE UNIQUE INDEX "Pago.serie_numero" ON "public"."Pago"("serie","numero")

ALTER TABLE "public"."InsumoProducto" ADD FOREIGN KEY ("productoId")REFERENCES "public"."Producto"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."InsumoProducto" ADD FOREIGN KEY ("insumoId")REFERENCES "public"."Insumo"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Reclamo" ADD FOREIGN KEY ("pedidoId", "productoId")REFERENCES "public"."DetallePedido"("pedidoId","productoId") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200614185430-migracion-inicial..20200614205310-arreglando-un-poco-la-base-de-datos
--- datamodel.dml
+++ datamodel.dml
@@ -1,47 +1,57 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model Cargo {
   id       Int        @default(autoincrement()) @id
   nombre   String     @unique
+  estado   Boolean    @default(true)
   personal Personal[]
 }
 model Personal {
-  id           Int         @default(autoincrement()) @id
-  nombres      String
-  apellidos    String
-  cargo        Cargo       @relation(fields: [cargoId], references: [id])
-  cargoId      Int
-  credencial   Credencial? @relation(fields: [credencialId], references: [id])
-  credencialId Int?
-  Pedido       Pedido[]
+  id               Int         @default(autoincrement()) @id
+  nombres          String
+  apellidos        String
+  cargo            Cargo       @relation(fields: [cargoId], references: [id])
+  cargoId          Int
+  credencial       Credencial? @relation(fields: [credencialId], references: [id])
+  credencialId     Int?
+  sueldo           Float
+  estado           Boolean     @default(true)
+  pedidosAtendidos Pedido[]
 }
 model Credencial {
   id       Int      @default(autoincrement()) @id
   usuario  String   @unique
   clave    String
+  estado   Boolean  @default(true)
   personal Personal
 }
 model Insumo {
-  id               Int             @default(autoincrement()) @id
-  nombre           String
-  fechaVencimiento DateTime?
-  compras          DetalleCompra[]
+  id                Int              @default(autoincrement()) @id
+  nombre            String
+  fechaVencimiento  DateTime?
+  cantidad          Float
+  unidad            String
+  estado            Boolean          @default(true)
+  comprasRealizadas DetalleCompra[]
+  productos         InsumoProducto[]
 }
 model Compra {
   id      Int             @default(autoincrement()) @id
   serie   String
   numero  String
   precio  Float
-  fecha   DateTime        @default(now())
+  fecha   DateTime
   insumos DetalleCompra[]
+
+  @@unique([serie, numero])
 }
 model DetalleCompra {
   insumo   Insumo @relation(fields: [insumoId], references: [id])
@@ -49,8 +59,9 @@
   compra   Compra @relation(fields: [compraId], references: [id])
   compraId Int
   importe  Float
   cantidad Int
+  unidad   String
   @@id([insumoId, compraId])
 }
@@ -60,29 +71,43 @@
   productos Producto[]
 }
 model Producto {
-  id             Int             @default(autoincrement()) @id
-  tipoProducto   TipoProducto    @relation(fields: [tipoProductoId], references: [id])
-  tipoProductoId Int
-  nombre         String
-  precio         Float
-  estado         Boolean
-  imagen         String
-  pedidos        DetallePedido[]
+  id                Int              @default(autoincrement()) @id
+  tipoProducto      TipoProducto     @relation(fields: [tipoProductoId], references: [id])
+  tipoProductoId    Int
+  nombre            String
+  descripcion       String
+  cantidad          Int
+  precio            Float
+  estado            Boolean          @default(true)
+  imagen            String
+  pedidosRealizados DetallePedido[]
+  receta            InsumoProducto[]
 }
+model InsumoProducto {
+  producto   Producto @relation(fields: [productoId], references: [id])
+  productoId Int
+  insumo     Insumo   @relation(fields: [insumoId], references: [id])
+  insumoId   Int
+  cantidad   Float
+  unidad     String
+  @@id([productoId, insumoId])
+}
+
 model Mesa {
-  id      Int      @default(autoincrement()) @id
-  numero  Int
-  ocupado Boolean
-  Pedido  Pedido[]
+  id                Int      @default(autoincrement()) @id
+  numero            Int
+  ocupado           Boolean  @default(false)
+  estado            Boolean  @default(true)
+  pedidosRealizados Pedido[]
 }
 model TipoPago {
-  id     Int    @default(autoincrement()) @id
-  nombre String @unique
-  pagos  Pago[]
+  id           Int    @default(autoincrement()) @id
+  nombre       String @unique
+  pagosPorTipo Pago[]
 }
 model Pago {
   id         Int      @default(autoincrement()) @id
@@ -93,37 +118,40 @@
   tipoPago   TipoPago @relation(fields: [tipoPagoId], references: [id])
   tipoPagoId Int
   pedido     Pedido   @relation(fields: [pedidoId], references: [id])
   pedidoId   Int
+  @@unique([serie, numero])
 }
 model Pedido {
   id         Int             @default(autoincrement()) @id
-  pago       Pago
+  pago       Pago?
   personal   Personal        @relation(fields: [personalId], references: [id])
   personalId Int
   mesa       Mesa            @relation(fields: [mesaId], references: [id])
   mesaId     Int
   fecha      DateTime        @default(now())
-  Reclamo    Reclamo[]
   productos  DetallePedido[]
 }
 model Reclamo {
-  id       Int    @default(autoincrement()) @id
-  pedido   Pedido @relation(fields: [pedidoId], references: [id])
-  pedidoId Int
-  motivo   String
+  id            Int           @default(autoincrement()) @id
+  detallePedido DetallePedido @relation(fields: [pedidoId, productoId], references: [pedidoId, productoId])
+  pedidoId      Int
+  productoId    Int
+  motivo        String
 }
 model DetallePedido {
-  pedido     Pedido   @relation(fields: [pedidoId], references: [id])
+  pedido     Pedido    @relation(fields: [pedidoId], references: [id])
   pedidoId   Int
-  producto   Producto @relation(fields: [productoId], references: [id])
+  producto   Producto  @relation(fields: [productoId], references: [id])
   productoId Int
   precio     Float
   cantidad   Int
-
+  entregado  Boolean   @default(false)
+  estado     Boolean   @default(true)
+  reclamos   Reclamo[]
   @@id([pedidoId, productoId])
 }
 generator client {
```


