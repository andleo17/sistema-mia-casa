# Migration `20200614185430-migracion-inicial`

This migration has been generated by Andres Baldarrago at 6/14/2020, 6:54:30 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Cargo" (
"id" SERIAL,"nombre" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Personal" (
"apellidos" text  NOT NULL ,"cargoId" integer  NOT NULL ,"credencialId" integer   ,"id" SERIAL,"nombres" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Credencial" (
"clave" text  NOT NULL ,"id" SERIAL,"usuario" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Insumo" (
"fechaVencimiento" timestamp(3)   ,"id" SERIAL,"nombre" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Compra" (
"fecha" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"numero" text  NOT NULL ,"precio" Decimal(65,30)  NOT NULL ,"serie" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."DetalleCompra" (
"cantidad" integer  NOT NULL ,"compraId" integer  NOT NULL ,"importe" Decimal(65,30)  NOT NULL ,"insumoId" integer  NOT NULL ,
    PRIMARY KEY ("insumoId","compraId"))

CREATE TABLE "public"."TipoProducto" (
"id" SERIAL,"nombre" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Producto" (
"estado" boolean  NOT NULL ,"id" SERIAL,"imagen" text  NOT NULL ,"nombre" text  NOT NULL ,"precio" Decimal(65,30)  NOT NULL ,"tipoProductoId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Mesa" (
"id" SERIAL,"numero" integer  NOT NULL ,"ocupado" boolean  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."TipoPago" (
"id" SERIAL,"nombre" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Pago" (
"fecha" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"monto" Decimal(65,30)  NOT NULL ,"numero" text  NOT NULL ,"pedidoId" integer  NOT NULL ,"serie" text  NOT NULL ,"tipoPagoId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Pedido" (
"fecha" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"mesaId" integer  NOT NULL ,"personalId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Reclamo" (
"id" SERIAL,"motivo" text  NOT NULL ,"pedidoId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."DetallePedido" (
"cantidad" integer  NOT NULL ,"pedidoId" integer  NOT NULL ,"precio" Decimal(65,30)  NOT NULL ,"productoId" integer  NOT NULL ,
    PRIMARY KEY ("pedidoId","productoId"))

CREATE UNIQUE INDEX "Cargo.nombre" ON "public"."Cargo"("nombre")

CREATE UNIQUE INDEX "Personal_credencialId" ON "public"."Personal"("credencialId")

CREATE UNIQUE INDEX "Credencial.usuario" ON "public"."Credencial"("usuario")

CREATE UNIQUE INDEX "TipoProducto.nombre" ON "public"."TipoProducto"("nombre")

CREATE UNIQUE INDEX "TipoPago.nombre" ON "public"."TipoPago"("nombre")

CREATE UNIQUE INDEX "Pago_pedidoId" ON "public"."Pago"("pedidoId")

ALTER TABLE "public"."Personal" ADD FOREIGN KEY ("cargoId")REFERENCES "public"."Cargo"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Personal" ADD FOREIGN KEY ("credencialId")REFERENCES "public"."Credencial"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."DetalleCompra" ADD FOREIGN KEY ("insumoId")REFERENCES "public"."Insumo"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."DetalleCompra" ADD FOREIGN KEY ("compraId")REFERENCES "public"."Compra"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Producto" ADD FOREIGN KEY ("tipoProductoId")REFERENCES "public"."TipoProducto"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Pago" ADD FOREIGN KEY ("tipoPagoId")REFERENCES "public"."TipoPago"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Pago" ADD FOREIGN KEY ("pedidoId")REFERENCES "public"."Pedido"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Pedido" ADD FOREIGN KEY ("personalId")REFERENCES "public"."Personal"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Pedido" ADD FOREIGN KEY ("mesaId")REFERENCES "public"."Mesa"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Reclamo" ADD FOREIGN KEY ("pedidoId")REFERENCES "public"."Pedido"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."DetallePedido" ADD FOREIGN KEY ("pedidoId")REFERENCES "public"."Pedido"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."DetallePedido" ADD FOREIGN KEY ("productoId")REFERENCES "public"."Producto"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200614185430-migracion-inicial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,131 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+model Cargo {
+  id       Int        @default(autoincrement()) @id
+  nombre   String     @unique
+  personal Personal[]
+}
+
+model Personal {
+  id           Int         @default(autoincrement()) @id
+  nombres      String
+  apellidos    String
+  cargo        Cargo       @relation(fields: [cargoId], references: [id])
+  cargoId      Int
+  credencial   Credencial? @relation(fields: [credencialId], references: [id])
+  credencialId Int?
+  Pedido       Pedido[]
+}
+
+model Credencial {
+  id       Int      @default(autoincrement()) @id
+  usuario  String   @unique
+  clave    String
+  personal Personal
+}
+
+model Insumo {
+  id               Int             @default(autoincrement()) @id
+  nombre           String
+  fechaVencimiento DateTime?
+  compras          DetalleCompra[]
+}
+
+model Compra {
+  id      Int             @default(autoincrement()) @id
+  serie   String
+  numero  String
+  precio  Float
+  fecha   DateTime        @default(now())
+  insumos DetalleCompra[]
+}
+
+model DetalleCompra {
+  insumo   Insumo @relation(fields: [insumoId], references: [id])
+  insumoId Int
+  compra   Compra @relation(fields: [compraId], references: [id])
+  compraId Int
+  importe  Float
+  cantidad Int
+
+  @@id([insumoId, compraId])
+}
+
+model TipoProducto {
+  id        Int        @default(autoincrement()) @id
+  nombre    String     @unique
+  productos Producto[]
+}
+
+model Producto {
+  id             Int             @default(autoincrement()) @id
+  tipoProducto   TipoProducto    @relation(fields: [tipoProductoId], references: [id])
+  tipoProductoId Int
+  nombre         String
+  precio         Float
+  estado         Boolean
+  imagen         String
+  pedidos        DetallePedido[]
+}
+
+model Mesa {
+  id      Int      @default(autoincrement()) @id
+  numero  Int
+  ocupado Boolean
+  Pedido  Pedido[]
+}
+
+model TipoPago {
+  id     Int    @default(autoincrement()) @id
+  nombre String @unique
+  pagos  Pago[]
+}
+
+model Pago {
+  id         Int      @default(autoincrement()) @id
+  serie      String
+  numero     String
+  fecha      DateTime @default(now())
+  monto      Float
+  tipoPago   TipoPago @relation(fields: [tipoPagoId], references: [id])
+  tipoPagoId Int
+  pedido     Pedido   @relation(fields: [pedidoId], references: [id])
+  pedidoId   Int
+}
+
+model Pedido {
+  id         Int             @default(autoincrement()) @id
+  pago       Pago
+  personal   Personal        @relation(fields: [personalId], references: [id])
+  personalId Int
+  mesa       Mesa            @relation(fields: [mesaId], references: [id])
+  mesaId     Int
+  fecha      DateTime        @default(now())
+  Reclamo    Reclamo[]
+  productos  DetallePedido[]
+}
+
+model Reclamo {
+  id       Int    @default(autoincrement()) @id
+  pedido   Pedido @relation(fields: [pedidoId], references: [id])
+  pedidoId Int
+  motivo   String
+}
+
+model DetallePedido {
+  pedido     Pedido   @relation(fields: [pedidoId], references: [id])
+  pedidoId   Int
+  producto   Producto @relation(fields: [productoId], references: [id])
+  productoId Int
+  precio     Float
+  cantidad   Int
+
+  @@id([pedidoId, productoId])
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
```


